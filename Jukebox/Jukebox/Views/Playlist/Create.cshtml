@model List<SongModel>
@using DataAccessLayer.Models;
@using Jukebox.Models;

<div class="container">

<div class="room-container container-fluid">
    <div class="row">
        <div class="col col-lg-9">
                <div class="pull-left"><h3 id="playlist-name">Ratchet 2013</h3></div><div id="room-type" class="pull-left">(Private)</div>
        </div>
        <div class="col col-lg-3 pull-right">
            @Html.ActionLink("Upload Music", "Upload", "Music", null, new { @class= "btn btn-primary pull-right", data_toggle="modal", href="#profileModal", @id = "create-upload-button"})
        </div>
    </div>


    <div class="row">
           
    </div>

    <div class="row">
        <div class="col col-lg-9 pull-left" >
            @Html.Partial("_RoomPlaylistPartial", Model)
            </div>


        <div class="col col-lg-3 pull-right">
            <table class="table table-bordered" id="members-table">
                <th>Room Members</th>
                <tr><td>Julio Garcia</td></tr>
                <tr><td>Casey Barbello </td></tr>
                <tr><td>Mathew Glodack </td></tr>
                <tr><td>Daryl Pham</td></tr>      
                </table>
        </div> 
    </div>
</div>
</div>

<nav class="navbar navbar-default navbar-fixed-bottom" id="bottom-music-player" role="navigation">
@if(Model.Count() > 0){
    @Html.Partial("_MusicPlayerPartial", Model)
}
</nav>

<script type="text/javascript">
    $(document).ready(function () {
        var audio;
        var playlist;
        var tracks;
        var current;
        var offset = 5; //number of td tags per row
        var currentSong = $('#current-song');
        var currentArtist = $('#current-artist');

        function init() {
            current = 0 * offset;
            audio = $('#audio');
            playlist = $('#music-playlist');
            tracks = playlist.find('tbody tr a');
            len = tracks.length - 1;
            audio[0].play();
            var song = playlist.find('tbody tr a')[current];
            var artist = playlist.find('tbody tr a')[current + 1];
            currentSong.text($(song).text());
            currentArtist.text($(artist).text());

            playlist.find('a').click(function (e) {
                e.preventDefault();
                link = $(this);

                current = (link.parent().parent().parent().index()) * 5;
                run($(link), audio[0]);
            });

            audio[0].addEventListener('ended', function (e) {
                current = current + 5;
                if (current == len) {
                    current = 0;
                    link = playlist.find('tbody tr a')[0];
                } else {
                    link = playlist.find('tbody tr a')[current];
                }
                run($(link), audio[0]);
            });
        }

        function run(link, player) {
            player.src = $(link).attr('href');
            selectedRow = $(link).parent().parent().parent();
            selectedRow.addClass('active-link').siblings().removeClass('active-link');
            audio[0].load();
            audio[0].play();
            var song = playlist.find('tbody tr a')[current];
            var artist = playlist.find('tbody tr a')[current + 1];
            currentSong.text($(song).text());
            currentArtist.text($(artist).text());
        }

        init();
    });
    
</script>

<!--
<nav class="navbar navbar-default navbar-fixed-bottom" id="bottom-music-player" role="navigation">
        <div class"pull-center">
             <li><audio controls="controls" loop="true">
                 <source type="audio/mp3" src="https://dl.dropboxusercontent.com/u/70488116/CS%2048/download.mp3" />
             </audio>
            </li>
        </div>
</nav>
-->

 
