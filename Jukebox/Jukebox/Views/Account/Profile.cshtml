@model List<SongModel>
@using DataAccessLayer.Models;
@using Jukebox.Models;


<header>
    <title>Profile</title>
</header>
<div class="profile-container container-fluid" id="profile-page-wrapper">
    <div class="row">
        <h3>Welcome @User.Identity.Name! @Html.ActionLink("Upload Music", "Upload", "Music", null, new { @class= "btn btn-primary pull-right", data_toggle="modal", href="#profileModal"})</h3>
    </div>
    <div class="row">
            <div class="col col-lg-9" id="profile-table-wrapper">
                <!--@if(Model.Count() > 0)
                {
                    @*<div class="box1">*@
                        <audio style="width:100%" controls="controls" id="audio" preload="auto" tabindex="0">
                            <source type="audio/mp3" src="../Music/@Model.First().FilePath" />
                            <source type="audio/aif" src="../Music/@Model.First().FilePath" />
                        </audio>
                    @*</div>*@
                }-->
                @Html.Partial("_PlaylistPartial", Model)
            </div>
        <div class="col col-lg-3">
            <ul class="nav nav-pills nav-stacked">
                <li class="clearfix"><a href="#">Songs<span class="badge pull-right">@Model.Count()</span></a></li>
                <li class="clearfix"><a href="#">Likes<span class="badge pull-right">0</span></a></li>
                <li class="clearfix"><a href="#">Following<span class="badge pull-right">0</span></a></li>
                <li class="clearfix"><a href="#">Followers<span class="badge pull-right">0</span></a></li>
            </ul>
        </div>
        </div>
    </div>
<!--
<nav class="navbar navbar-default navbar-fixed-bottom" id="bottom-music-player" role="navigation">
   @if(Model.Count() > 0)
                {
                    <div class="row">                    
                        <div id="current-music"><h5 id="current-song-header"><strong id="current-song"></strong> by <strong id="current-artist"></strong></h5></div>
                    </div>
                    <div class="row">
                        <audio style="width:100%" controls="controls" id="audio" preload="auto" tabindex="0">
                            <source type="audio/mp3" src="../Music/@Model.First().FilePath" />
                            <source type="audio/aif" src="../Music/@Model.First().FilePath" />
                        </audio>
                    </div>
                }
</nav>
-->

@if(Model.Count() > 0){
    @Html.Partial("_MusicPlayerPartial", Model)
}

  <!-- Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Upload Music</h4>
            </div>
                @using (Html.BeginForm("Save", "Music", FormMethod.Post, new { @enctype = "multipart/form-data" }))
                {
                    <form class="form-horizontal" role="form">
                        <div class="modal-body"> 
                            @Html.AntiForgeryToken()
                            @Html.ValidationSummary(true)
                            <div class="container-fluid">
                                <div>
                                    <div class="col col-lg-9">
                                            <label class="control-label col col-lg-6">Spice up your playlist</label>
                                            <div class="form-group">
                                                
                                                <div class="col-lg-6 input-div">
                                                    <input type="file" multiple name="file" />
                                                </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <input type="submit" value="Upload" class="btn btn-primary pull-right" />
                            <button type="button" class="btn btn-default pull-right" data-dismiss="modal">Close</button>
                        </div>
                    </form>
                }
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript">
    $(document).ready(function () {
        var audio;
        var playlist;
        var tracks;
        var current;
        var offset = 5; //number of td tags per row
        var currentSong = $('#current-song');
        var currentArtist = $('#current-artist');

        function init() {
            current = 0 * offset;
            audio = $('#audio');
            playlist = $('#music-playlist');
            tracks = playlist.find('tbody tr a');
            len = tracks.length - 1;
            audio[0].play();
            var song = playlist.find('tbody tr a')[current];
            var artist = playlist.find('tbody tr a')[current + 1];
            currentSong.text($(song).text());
            currentArtist.text($(artist).text());

            playlist.find('a').click(function (e) {
                e.preventDefault();
                link = $(this);

                current = (link.parent().parent().parent().index()) * 5;
                run($(link), audio[0]);
            });

            audio[0].addEventListener('ended', function (e) {
                current = current + 5;
                if (current == len) {
                    current = 0;
                    link = playlist.find('tbody tr a')[0];
                } else {
                    link = playlist.find('tbody tr a')[current];
                }
                run($(link), audio[0]);
            });
        }

        function run(link, player) {
            player.src = $(link).attr('href');
            selectedRow = $(link).parent().parent().parent();
            selectedRow.addClass('active-link').siblings().removeClass('active-link');
            audio[0].load();
            audio[0].play();
            var song = playlist.find('tbody tr a')[current];
            var artist = playlist.find('tbody tr a')[current + 1];
            currentSong.text($(song).text());
            currentArtist.text($(artist).text());
        }

        init();
    });
    
</script>